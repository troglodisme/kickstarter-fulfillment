<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirm Your Kickstarter Rewards</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 20px 20px 0 0;
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #f7fafc;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        .header p {
            font-size: 1.1rem;
            color: #4a5568;
        }
        
        .main-content {
            background: white;
            border-radius: 0 0 20px 20px;
            overflow: hidden;
        }
        
        .section {
            padding: 30px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        .section h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pledged-items {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }
        
        .pledged-items h2 {
            color: white;
        }
        
        .item-grid {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }
        
        .item-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .item-info h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .item-price {
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        .item-quantity {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .discount-section {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
        }
        
        .discount-section h2 {
            color: white;
        }
        
        .discount-code {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-top: 15px;
        }
        
        .discount-amount {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .code-display {
            background: rgba(255, 255, 255, 0.9);
            color: #2d3748;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .code-display:hover {
            background: white;
            transform: scale(1.02);
        }
        
        .browse-section {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }
        
        .browse-section h2 {
            color: white;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: rgba(255, 255, 255, 0.9);
            color: #2d3748;
        }
        
        .btn-primary:hover {
            background: white;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .total-summary {
            background: #f7fafc;
            padding: 25px;
            text-align: center;
        }
        
        .total-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .total-final {
            font-size: 1.5rem;
            font-weight: bold;
            color: #48bb78;
            border-top: 2px solid #e2e8f0;
            padding-top: 15px;
            margin-top: 15px;
        }
        
        .note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #856404;
            font-size: 0.95rem;
        }
        
        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .copy-notification.show {
            transform: translateX(0);
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .total-line {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéâ Your Kickstarter Rewards Are Ready!</h1>
            <p>Confirm your pledged items and browse our store for additional products</p>
        </div>
        
        <div class="main-content">
            <!-- Pledged Items Section -->
            <div class="section pledged-items">
                <h2>üéÅ Your Pledged Rewards</h2>
                <p>These items are included with your Kickstarter pledge:</p>
                
                <div class="item-grid" id="pledged-items">
                    <!-- Items will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Discount Section -->
            <div class="section discount-section">
                <h2>üí∞ Your Kickstarter Credit</h2>
                <div class="discount-code">
                    <div class="discount-amount" id="discount-amount">-¬£253.00</div>
                    <p>Your Kickstarter pledge amount will be credited at checkout</p>
                    
                    <div class="code-display" id="discount-code-display" onclick="copyDiscountCode()">
                        KS1_123456
                    </div>
                    <p style="font-size: 0.9rem; opacity: 0.8;">Click to copy discount code</p>
                </div>
            </div>
            
            <!-- Browse Store Section -->
            <div class="section browse-section">
                <h2>üõí Add More Products</h2>
                <p>Browse our complete collection and add anything else you'd like. Your Kickstarter credit will be applied automatically.</p>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="proceedWithPledgedOnly()">
                        ‚úÖ Checkout with Pledged Items Only
                    </button>
                    
                    <button class="btn btn-secondary" onclick="browseAndAdd()">
                        üõçÔ∏è Browse Store & Add More
                    </button>
                </div>
                
                <div class="note">
                    <strong>How it works:</strong>
                    <br>1. Click "Browse Store" to see all available products
                    <br>2. Add anything to your cart alongside your pledged items
                    <br>3. Use discount code at checkout - you'll only pay for extras!
                </div>
            </div>
            
            <!-- Total Summary -->
            <div class="total-summary">
                <div class="total-line">
                    <span>Pledged Items Total:</span>
                    <span id="pledged-total">¬£233.00</span>
                </div>
                <div class="total-line">
                    <span>Kickstarter Credit:</span>
                    <span id="credit-amount" style="color: #48bb78;">-¬£253.00</span>
                </div>
                <div class="total-line total-final">
                    <span>You Pay for Pledged Items:</span>
                    <span>¬£0.00</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Copy Notification -->
    <div class="copy-notification" id="copy-notification">
        ‚úÖ Discount code copied to clipboard!
    </div>
    
    <script>
        let customerData = {};
        
        // Load customer data from URL parameters or API
        window.addEventListener('DOMContentLoaded', function() {
            loadCustomerData();
        });
        
        function loadCustomerData() {
            // Get customer ID from URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const customerId = urlParams.get('customer');
            
            // Get token from URL path
            const pathParts = window.location.pathname.split('/');
            const token = pathParts[pathParts.length - 1];
            
            if (token && token !== 'basket-confirmation.html') {
                // Load real data from API
                fetch(`/api/customer/${token}`)
                    .then(response => response.json())
                    .then(data => {
                        customerData = data;
                        renderCustomerData();
                    })
                    .catch(error => {
                        console.error('Error loading customer data:', error);
                        // Fall back to test data
                        loadTestData();
                    });
            } else {
                // Load test data for direct access
                loadTestData();
            }
        }
        
        function loadTestData() {
            customerData = {
                name: 'Frederik Stott',
                email: 'frederik2600@gmail.com',
                pledgeAmount: 253.00,
                discountCode: 'KS1_123456',
                pledgedItems: [
                    { name: 'Ambient One (Black)', price: 139.00, quantity: 1, variantId: '52337643290957' },
                    { name: 'Charging Dock + Formaldehyde Sensor', price: 72.00, quantity: 1, variantId: '52321245593933' },
                    { name: 'Accessories Pack', price: 22.00, quantity: 1, variantId: '52321243267405' }
                ],
                cartLink: 'https://shop.ambientworks.io/cart/52337643290957:1,52321245593933:1,52321243267405:1',
                shopDomain: 'shop.ambientworks.io'
            };
            renderCustomerData();
        }
        
        function renderCustomerData() {
            // Update discount amount
            document.getElementById('discount-amount').textContent = `-¬£${customerData.pledgeAmount.toFixed(2)}`;
            document.getElementById('credit-amount').textContent = `-¬£${customerData.pledgeAmount.toFixed(2)}`;
            document.getElementById('discount-code-display').textContent = customerData.discountCode;
            
            // Calculate total
            const pledgedTotal = customerData.pledgedItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('pledged-total').textContent = `¬£${pledgedTotal.toFixed(2)}`;
            
            // Render pledged items
            const itemsContainer = document.getElementById('pledged-items');
            itemsContainer.innerHTML = '';
            
            customerData.pledgedItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-card';
                itemDiv.innerHTML = `
                    <div class="item-info">
                        <h3>${item.name}</h3>
                        <div style="opacity: 0.8; font-size: 0.9rem;">¬£${item.price.toFixed(2)} each</div>
                    </div>
                    <div class="item-quantity">Qty: ${item.quantity}</div>
                `;
                itemsContainer.appendChild(itemDiv);
            });
        }
        
        function copyDiscountCode() {
            navigator.clipboard.writeText(customerData.discountCode).then(() => {
                showCopyNotification();
            }).catch(err => {
                console.error('Failed to copy: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = customerData.discountCode;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopyNotification();
            });
        }
        
        function showCopyNotification() {
            const notification = document.getElementById('copy-notification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function proceedWithPledgedOnly() {
            // Copy discount code first
            copyDiscountCode();
            
            // Guide user through the process
            alert(`‚úÖ Discount code "${customerData.discountCode}" copied!

Next steps:
1. We'll open your Shopify checkout
2. Enter your email and details
3. Paste the discount code in the "Discount code" field
4. Your ¬£${customerData.pledgeAmount.toFixed(2)} credit will be applied!`);
            
            // Open shop with discount code directly
            setTimeout(() => {
                window.open(`https://${customerData.shopDomain}/discount/${customerData.discountCode}`, '_blank');
            }, 1500);
        }
        
        function browseAndAdd() {
            // Copy discount code first
            copyDiscountCode();
            
            alert(`‚úÖ Discount code "${customerData.discountCode}" copied!

Instructions:
1. We'll open your pre-filled cart with pledged items
2. Browse the store and add any additional products you want
3. When ready, click "Checkout"
4. Paste your discount code at checkout
5. You'll only pay for the extras (pledged items are free)!`);
            
            // Open pre-filled cart
            setTimeout(() => {
                window.open(customerData.cartLink, '_blank');
            }, 1500);
        }
    </script>
</body>
</html>
